<!DOCTYPE html>
<html>
<head>
    <title>Auction Data</title>
    <link class="favicon" rel="shortcut icon" type="image/x-icon" id="dynamic-favicon" href="https://ssbprod.wichita.edu/wu-shock-favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">  
    <link href="static/css/main.css" rel="stylesheet" type="text/css">
    <link href="static/css/slide-links-style.css" rel="stylesheet" type="text/css">
    <link href="static/css/search-container.css" rel="stylesheet" type="text/css">
    <link href="static/css/products.css" rel="stylesheet" type="text/css">
</head>
<body>
    <div class="header"></div>
    <div class="main">
        <form method="get" action="{% url 'filtered_items' %}">
            <div class="search-container">
                <input type="text" id="search_id" name="search_id" placeholder="Enter an Id" value={{search_id}} >
                <button type="submit">Search</button>
            </div>
        </form>
        <form method="get" action="{% url 'filtered_items' %}">
            <div class="search-container">
                <input type="text" id="title_search" name="title_search" placeholder="Enter Title" value={{title_search}} >
                <button type="submit">Search</button>
            </div>
        </form>
        <form method="get" action="{% url 'filtered_items' %}">
            <div class="search-container">
                <select name="brand" id="brand">
                    <option value="">All Brands</option>
                    {% for brand in distinct_brands %}
                        <option value="{{ brand }}" {% if brand == selected_brand %}selected{% endif %}>{{ brand }}</option>
                    {% endfor %}
                </select>
                
                <select name="seller" id="seller">
                    <option value="">All Sellers</option>
                    {% for seller in distinct_sellers %}
                        <option value="{{ seller }}" {% if seller == selected_seller %}selected{% endif %}>{{ seller }}</option>
                    {% endfor %}
                </select>

                <button type="submit">Apply Filters</button>
            </div>
        </form>

        <ul id="items-container">
            {% for item in items %}
                {% comment %} Start of Product List {% endcomment %}
                <div class="{{item.itemId}} slideshow-container" data-id="{{item.itemId}}">
                    <input type="checkbox" id="{{item.itemId}}_checkbox" class="product-grey-scale" onclick="toggleGrayScale('{{item.itemId}}')" name="product-grey-scale-checkbox">
                    <div class="slideshow-content" onclick="openProductModal('{{item.itemId}}')">
                        {% for key,value in item_images.items %}
                            {% if item.itemId in key %}
                                {% for image_link in value %}
                                    <div class="{{item.itemId}} mySlides">
                                        <img class="slideshow-img" src="{{ image_link }}" alt="Product Image">
                                    </div>
                                {% endfor %}
                            {% endif %}
                            
                        {% endfor %}
                    </div>

                    <div class="prev-next-links">
                        <a class="prev" onclick="plusSlides(-1, '{{item.itemId}}' , 'mySlides')">&#10094;</a>
                        <a class="next" onclick="plusSlides(1, '{{item.itemId}}' , 'mySlides')">&#10095;</a>
                    </div>
                    <strong class="product-id">{{item.itemId}}</strong>
                </div>

                {% comment %} End of Product List {% endcomment %}

                {% comment %} Modal Starts Here {% endcomment %}

                <div class="{{item.itemId}} modal">
                    <div class="modal-content">
                        <div class="product-card">
                            {% for key,value in item_images.items %}
                                {% if item.itemId in key %}
                                    {% for image_link in value %}
                                        <div class="{{item.itemId}} modal-image-container">
                                            <img class="modal-img" src="{{ image_link }}" alt="Product Image">
                                        </div>
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                            <div class="prev-next-links">
                                <a class="prev" onclick="plusSlides(-1, '{{item.itemId}}' , 'modal-image-container')">&#10094;</a>
                                <a class="next" onclick="plusSlides(1, '{{item.itemId}}' , 'modal-image-container')">&#10095;</a>
                            </div>
                        </div>
                        <div class="product-details">
                            <div class="modal-product-id">
                                <label class="detail-label">Product Id</label> 
                                <span>{{item.itemId}}</span>
                            </div>
                            <div class="product-title">
                                <label class="detail-label">Title</label> 
                                <span>{{item.title}}</span>
                            </div>
                            <div class="product-seller">
                                <label class="detail-label">Seller</label> 
                                <span>{{item.sellerName}}</span>
                            </div>
                            <div class="product-brand">
                                <label class="detail-label">Brand</label> 
                                <span>{{item.brand}}</span>
                            </div>
                            <div class="product-price">
                                <label class="detail-label">Price</label> 
                                <span>{{item.price}}</span>
                            </div>
                            <div class="product-description">
                                <label class="detail-label">Features</label>
                                <iframe src="https://vi.vipr.ebaydesc.com/ws/eBayISAPI.dll?ViewItemDescV4&item=110971084829" width="100%" height="400" frameborder="0" allowfullscreen></iframe>
                                {% comment %} <ol class="product-description-list">
                                    {% for key,value in item_descriptions.items %}
                                        {% if item.itemId in key %}
                                            {% for feature in value %}
                                                <li>{{feature}}</li>
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                </ol>  {% endcomment %}
                            </div>
                        </div>
                    </div>
                    <div class="close-btn" onclick="closeProductModal('{{item.itemId}}')" >
                        <img class="close-img" src="static/Images/close.png" />
                    </div>
                </div>

                {% comment %} End of Modal {% endcomment %}
            {% endfor %}
        </ul>
        <div class="load-more-container">
            <button id="load-more" data-url="{% url 'load_more_items' %}" data-selected-brand="{{selected_brand}}" data-selected-seller="{{selected_seller}}" data-title-search="{{title_search}}" data-offset="36">Load More</button>
        </div>
    </div>
    <div class="footer"></div>
    <script src="static/js/slide-show.js"></script>
    <script src="static/js/checkbox.js"></script>
    <script src="static/js/modal.js"></script>
    <script>
        var loading = false;
    
        function loadMoreItems() {
            if (!loading) {
                loading = true;
                var url = document.getElementById('load-more').getAttribute('data-url');
                var offset = document.getElementById('load-more').getAttribute('data-offset');
                var selectedBrand = document.getElementById('load-more').getAttribute('data-selected-brand');
                var selectedSeller = document.getElementById('load-more').getAttribute('data-selected-seller');
                var titleSearch = document.getElementById('load-more').getAttribute('data-title-search');

    
                fetch(url + '?offset=' + offset + '&brand=' + selectedBrand + '&seller=' + selectedSeller + '&title_search=' + titleSearch)
                    .then(response => response.json())
                    .then((data) => {
                        itemList = ""
                        data.items.forEach((item) => {
                            first = true
                            modalFirst = true
                            item_div = ""
                            item_div += '<div class="' + item.fields.itemId + ' slideshow-container" data-id="'+ item.fields.itemId+ '">'
                            item_div += '<input type="checkbox" id="'+ item.fields.itemId+ '_checkbox" class="product-grey-scale" onclick="toggleGrayScale(\'' + item.fields.itemId + '\')" name="product-grey-scale-checkbox">'
                            item_div +=  '<div class="slideshow-content" onclick="openProductModal(\'' +  item.fields.itemId + '\')">'
                            for(let key in data.item_images){
                                if(item.fields.itemId == key ){
                                    data.item_images[key].forEach((image_link) => {
                                        if(first){
                                            item_div += '<div class="' + item.fields.itemId + ' mySlides" style="display: block;"><img class="slideshow-img" src="'+ image_link +'" alt="Product Image"></div>'
                                            first = false
                                        }else{
                                            item_div += '<div class="' + item.fields.itemId + ' mySlides" style="display: none;"><img class="slideshow-img" src="'+ image_link +'" alt="Product Image"></div>'
                                        }
                                    })
                                }
                            }
                            item_div += '</div><div class="prev-next-links">'
                            item_div += '<a class="prev" onclick="plusSlides(-1, \'' + item.fields.itemId + '\' , \'mySlides\')">&#10094;</a>'
                            item_div += '<a class="next" onclick="plusSlides(1, \'' + item.fields.itemId + '\' , \'mySlides\')">&#10095;</a></div>'
                            item_div += '<strong class="product-id">' + item.fields.itemId + '</strong></div>'
                            item_div += '<div class="' + item.fields.itemId +' modal"><div class="modal-content"><div class="product-card">'
                            for(let key in data.item_images){
                                if(item.fields.itemId == key ){
                                    data.item_images[key].forEach((image_link) => {
                                        if(modalFirst){
                                            item_div += '<div class="' + item.fields.itemId + ' modal-image-container" style="display: block;"><img class="modal-img" src="'+ image_link +'" alt="Product Image"></div>'
                                            modalFirst = false
                                        }else{
                                            item_div += '<div class="' + item.fields.itemId + ' modal-image-container" style="display: none;"><img class="modal-img" src="'+ image_link +'" alt="Product Image"></div>'
                                        }
                                    })
                                }
                            }
                                        
                            item_div += '<div class="prev-next-links">'
                            item_div += '<a class="prev" onclick="plusSlides(-1, \'' + item.fields.itemId + '\' , \'modal-image-container\')">&#10094;</a>'
                            item_div += '<a class="next" onclick="plusSlides(1, \'' + item.fields.itemId + '\' , \'modal-image-container\')">&#10095;</a></div></div>'
                            item_div += '<div class="product-details"><div class="modal-product-id"><label class="detail-label">Product Id</label> <span>' + item.fields.itemId + '</span></div>'
                            item_div += '<div class="product-title"><label class="detail-label">Title</label> <span>' + item.fields.title + '</span></div>'
                            item_div += '<div class="product-seller"><label class="detail-label">Seller</label> <span>' + item.fields.sellerName + '</span></div>'
                            item_div += '<div class="product-brand"><label class="detail-label">Brand</label> <span>' + item.fields.brand + '</span></div>'
                            item_div += '<div class="product-price"><label class="detail-label">Price</label> <span>' + item.fields.price + '</span></div>'
                            item_div += '<div class="product-description"><label class="detail-label">Features</label>'
                            item_div += '<iframe src="https://vi.vipr.ebaydesc.com/ws/eBayISAPI.dll?ViewItemDescV4&item=110971084829" width="100%" height="400" frameborder="0" allowfullscreen></iframe></div></div></div>'
                            item_div += '<div class="close-btn" onclick="closeProductModal(\'' + item.fields.itemId + '\')" ><img class="close-img" src="static/Images/close.png" /></div></div>'
                            itemList += item_div
                        })
                        var itemsContainer = document.getElementById('items-container');
                        itemsContainer.innerHTML += itemList
                        document.getElementById('load-more').setAttribute('data-offset', parseInt(offset) + 24);
                        loading = false;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        loading = false;
                    });
            }
        }
    
        document.getElementById('load-more').addEventListener('click', loadMoreItems);
    </script>
</body>
</html>
